

09:26 PM

Konda Reddy Lingaladinne

beow link is very good link for kubectl commands

https://kubernetes.io/docs/reference/kubectl/cheatsheet/

Konda Reddy Lingaladinne

https://medium.com/devopslinks/how-to-setup-a-perfect-kubernetes-cluster-using-kops-in-aws-b616bdfae013

Konda Reddy Lingaladinne
https://kubernetes.io/docs/reference/kubectl/cheatsheet/
kubectl config get-contexts
 1630  kubectl config use-context c1.ap-southeast-1.aws.dp.dev.f5aas.com
 1631  kubectl config current-context
 1632  kubectl  get pods
 1633  cat ~/.kube/config
 1634  clear
 1635  kubectl get pods
kubectl get all --all-namespaces  this command will give all namespaces pods,services,replicasets 
 1636  kubectl  get pods --all-namespaces
 1637  kubectl  get ns
 1638  kubectl  get svc
 1639  kubectl  get svc --all-namespaces
 1640  kubectl  get nodes
 1641  kubectl get nodes -o wide     this will give more details like node ip's etc
 1642  history
 1643  export | grep -i aws
 1644  declare -x AWS_ACCESS_KEY_ID="AKIAI7A6G43DLOGRVUEQ"
 1645  declare -x AWS_SECRET_ACCESS_KEY="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"
 1646  kops get  ig  --name c1.eu-central-1.aws.dp.dev.f5aas.com  --state s3://f5aas-kops-k8s-dev-eu-central-1
 1647  kubectl  get nodes	
 1648  kubectl  get pods -n monitoring
 1649  kubectl  get pv
 1650  kubectl  get pv,pvc --all-namespaces
 1651  kubectl  gte pvc
 1652  kubectl  get pvc
 1653  kubectl  get pvc  mysql-testing  -o yaml
 1654  kubectl get pods -n logging
 1655  kubectl describe fluentd-0 -n logging
 16
=====================================================
cat  $HOME/.kube/config

https://github.com/prometheus/cloudwatch_exporter/issues/38
kubectl get deloyemnets 
kubectl get rs 
kubectl get pods 
kubectl expose deployement hw  --type=NodePort
kubectl get services 
minikube service hw 
kubectl get all 
kubectl get deploy/hw -o yaml 
kubectl create -f .yaml
kubectl get deployements 
kubectl get rs 
kubectl get cs --> to check pods health status 
kubectl scale --replicas=3 deploy/hellowrold-deploement
kubectl scale deployments/twocontainers --replicas=4
kubectl get deploy/podname 
kubectl get pods  
kubectl reate -f podyaml
kubectl get pods --show-lables 
kubectl delete -f alpine.yaml  --->> To delete the yaml  pod  file 
to tag a pod
kubectl lable po/ponamr app=hello
880826687
https://github.com/kondareddy103/cicd-pipeline-train-schedule-jenkins
https://app.shippable.com/accounts/5b540b3c9fde880700d6cec0/dashboard
100001693539  
https://training-lms.redhat.com/lmt/clmsCatalogSummary.prMain?in_sessionid=2J2219JAA939830&in_portid=6&in_autoquery=Y&in_orderBy=PA&in_

================

master $ kubectl create -f test.yaml
pod/declarative-pod created

master $ kubectl get pods
NAME              READY     STATUS    RESTARTS   AGE
declarative-pod   1/1       Running   0          59s
master $
master $ kubectl get pods -o wide
NAME              READY     STATUS    RESTARTS   AGE       IP          NODE      NOMINATED NODE
declarative-pod   1/1       Running   0          1m        10.40.0.1   node01    <none>
master $
==================
veeresh_infra@cloudshell:~ (decent-being-246011)$ kubectl delete pod nginx
pod "nginx" deleted
veeresh_infra@cloudshell:~ (decent-being-246011)$
kubectl annotate - Update the annotations on a resource
kubectl api-resources - Print the supported API resources on the server
kubectl api-versions - Print the supported API versions on the server, in the form of “group/version”
kubectl apply - Apply a configuration to a resource by filename or stdin
kubectl attach - Attach to a running container
kubectl auth - Inspect authorization
kubectl autoscale - Auto-scale a Deployment, ReplicaSet, or ReplicationController
kubectl certificate - Modify certificate resources.
kubectl cluster-info - Display cluster info
kubectl completion - Output shell completion code for the specified shell (bash or zsh)
kubectl config - Modify kubeconfig files
kubectl convert - Convert config files between different API versions
kubectl cordon - Mark node as unschedulable
kubectl cp - Copy files and directories to and from containers.
kubectl create - Create a resource from a file or from stdin.
kubectl delete - Delete resources by filenames, stdin, resources and names, or by resources and label selector
kubectl describe - Show details of a specific resource or group of resources
kubectl diff - Diff live version against would-be applied version
kubectl drain - Drain node in preparation for maintenance
kubectl edit - Edit a resource on the server
kubectl exec - Execute a command in a container
kubectl explain - Documentation of resources
kubectl expose - Take a replication controller, service, deployment or pod and expose it as a new Kubernetes Service
kubectl get - Display one or many resources
kubectl kustomize - Build a kustomization target from a directory or a remote url.
kubectl label - Update the labels on a resource
kubectl logs - Print the logs for a container in a pod
kubectl options - Print the list of flags inherited by all commands
kubectl patch - Update field(s) of a resource using strategic merge patch
kubectl plugin - Provides utilities for interacting with plugins.
kubectl port-forward - Forward one or more local ports to a pod
kubectl proxy - Run a proxy to the Kubernetes API server
kubectl replace - Replace a resource by filename or stdin
kubectl rollout - Manage the rollout of a resource
kubectl run - Run a particular image on the cluster
kubectl scale - Set a new size for a Deployment, ReplicaSet, Replication Controller, or Job
kubectl set - Set specific features on objects
kubectl taint - Update the taints on one or more nodes
kubectl top - Display Resource (CPU/Memory/Storage) usage.
kubectl uncordon - Mark node as schedulable
kubectl version - Print the client and server version information
kubectl wait - Experimental: Wait for a specific condition on one or many resources.
kubectl apply -f nginx --validate=false   --- to skip the validations 
kubectl edit svc prometheus-kube-state-metrics -n monitoring            --->> for editing service
to het pods in name spaces wise

to get the roles namespace wise

veeresh_infra@kmaster:~$ kubectl get roles --all-namespaces
NAMESPACE              NAME                                             AGE
kube-public            kubeadm:bootstrap-signer-clusterinfo             14d
kube-public            system:controller:bootstrap-signer               14d
kube-system            extension-apiserver-authentication-reader        14d
kube-system            kube-proxy                                       14d
kube-system            kubeadm:kubelet-config-1.16                      14d
kube-system            kubeadm:nodes-kubeadm-config                     14d
kube-system            system::leader-locking-kube-controller-manager   14d
kube-system            system::leader-locking-kube-scheduler            14d
kube-system            system:controller:bootstrap-signer               14d
kube-system            system:controller:cloud-provider                 14d
kube-system            system:controller:token-cleaner                  14d
kube-system            weave-net                                        14d
kubernetes-dashboard   kubernetes-dashboard                             10d
monitoring             prometheus-grafana                               42h
monitoring             prometheus-grafana-test                          42h
veeresh_infra@kmaster:~$
to get the serviceaccounts for all name spaces
veeresh_infra@kmaster:~$ kubectl get serviceaccounts --all-namespaces
NAMESPACE              NAME                                      SECRETS   AGE
default                default                                   1         14d
kube-node-lease        default                                   1         14d
kube-public            default                                   1         14d
kube-system            attachdetach-controller                   1         14d
kube-system            bootstrap-signer                          1         14d
kube-system            calico-cni-plugin                         1         14d
kube-system            calico-kube-controllers                   1         14d
kube-system            certificate-controller                    1         14d
kube-system            clusterrole-aggregation-controller        1         14d
kube-system            coredns                                   1         14d
kube-system            cronjob-controller                        1         14d
kube-system            daemon-set-controller                     1         14d
kube-system            default                                   1         14d
kube-system            deployment-controller                     1         14d
kube-system            disruption-controller                     1         14d
kube-system            endpoint-controller                       1         14d
kube-system            expand-controller                         1         14d
kube-system            generic-garbage-collector                 1         14d
kube-system            horizontal-pod-autoscaler                 1         14d
kube-system            job-controller                            1         14d
kube-system            kube-proxy                                1         14d
kube-system            namespace-controller                      1         14d
kube-system            node-controller                           1         14d
kube-system            persistent-volume-binder                  1         14d
kube-system            pod-garbage-collector                     1         14d
kube-system            pv-protection-controller                  1         14d
kube-system            pvc-protection-controller                 1         14d
kube-system            replicaset-controller                     1         14d
kube-system            replication-controller                    1         14d
kube-system            resourcequota-controller                  1         14d
kube-system            service-account-controller                1         14d
kube-system            service-controller                        1         14d
kube-system            statefulset-controller                    1         14d
kube-system            tiller                                    1         43h
kube-system            token-cleaner                             1         14d
kube-system            ttl-controller                            1         14d
kube-system            weave-net                                 1         14d
kubernetes-dashboard   default                                   1         10d
kubernetes-dashboard   kubernetes-dashboard                      1         10d
monitoring             default                                   1         3d21h
monitoring             prometheus-grafana                        1         42h
monitoring             prometheus-grafana-test                   1         42h
monitoring             prometheus-kube-state-metrics             1         42h
monitoring             prometheus-prometheus-node-exporter       1         42h
monitoring             prometheus-prometheus-oper-alertmanager   1         42h
monitoring             prometheus-prometheus-oper-operator       1         42h
monitoring             prometheus-prometheus-oper-prometheus     1         42h
veeresh_infra@kmaster:~$



veeresh_infra@cloudshell:~/ckad (decent-being-246011)$ kubectl get pods -n=kube-system
NAME                                                           READY   STATUS    RESTARTS   AGE
event-exporter-v0.2.4-5f88c66fb7-498l4                         2/2     Running   0          2d19h
fluentd-gcp-scaler-59b7b75cd7-5vwjz                            1/1     Running   0          2d19h
fluentd-gcp-v3.2.0-ffc5v                                       2/2     Running   0          2d19h
fluentd-gcp-v3.2.0-qqdbs                                       2/2     Running   0          2d19h
heapster-v1.6.1-5fb8844cdf-zpfb7                               3/3     Running   0          2d19h
kube-dns-6987857fdb-lfjr8                                      4/4     Running   0          79m
kube-dns-6987857fdb-vsq56                                      4/4     Running   0          2d19h
kube-dns-autoscaler-bb58c6784-h2bl6                            1/1     Running   0          2d19h
kube-proxy-gke-standard-cluster-1-default-pool-7c2cbea9-0qwz   1/1     Running   0          2d19h
kube-proxy-gke-standard-cluster-1-default-pool-7c2cbea9-frbw   1/1     Running   0          2d19h
l7-default-backend-fd59995cd-pcvgv                             1/1     Running   0          2d19h
metrics-server-v0.3.1-57c75779f-d5ndg                          2/2     Running   0          2d19h
prometheus-to-sd-9kjhd                                         1/1     Running   0          2d19h
prometheus-to-sd-pkb89                                         1/1     Running   0          2d19h
veeresh_infra@cloudshell:~/ckad (decent-being-246011)$

to get the events from the cluster

veeresh_infra@kmaster:~$ kubectl get events
LAST SEEN   TYPE      REASON          OBJECT                           MESSAGE
24m         Normal    Pulled          pod/busybox                      Container image "busybox" already present on machine
24m         Normal    Created         pod/busybox                      Created container busybox
24m         Normal    Started         pod/busybox                      Started container busybox
45m         Normal    Pulled          pod/daemonset-pods-7ptvm         Container image "gcr.io/google-containers/watcher-daemonset" already present on machine
55m         Normal    Started         pod/daemonset-pods-7ptvm         Started container daemon-container
49s         Warning   BackOff         pod/daemonset-pods-7ptvm         Back-off restarting failed container
60m         Normal    Pulled          pod/daemonset-pods-dvhnq         Container image "gcr.io/google-containers/watcher-daemonset" already present on machine
46s         Warning   BackOff         pod/daemonset-pods-dvhnq         Back-off restarting failed container
24m         Normal    Pulled          pod/morevol2                     Container image "centos:7" already present on machine
24m         Normal    Created         pod/morevol2                     Created container centos1
24m         Normal    Started         pod/morevol2                     Started container centos1
24m         Normal    Pulled          pod/morevol2                     Container image "centos:7" already present on machine
24m         Normal    Created         pod/morevol2                     Created container centos2
24m         Normal    Started         pod/morevol2                     Started container centos2
20s         Normal    FailedBinding   persistentvolumeclaim/pv-claim   no persistent volumes available for this claim and no storage class is set

===================

veeresh_infra@cloudshell:~/ckad (decent-being-246011)$ kubectl scale --replicas=9 Replicaset rsdemo          ---->>(you you have to specify the kind name(which is available in yaml) and metadata name(pod name) you can put with / simbol separtion or with space both the words for
replicaset.extensions/rsdemo scaled
veeresh_infra@cloudshell:~/ckad (decent-being-246011)$ kubectl scale --replicas=3 Replicaset/rsdemo
replicaset.extensions/rsdemo scaled
===================
Debuging kubernetes-->> it will generate the dump and write into dump.log what ever file name u want u give. which will have all k8s cluster and node health info 
veeresh_infra@cloudshell:~$ kubectl cluster-info dump > dump.log
veeresh_infra@cloudshell:~$ ls -lrt dump.log
-rw-r--r-- 1 veeresh_infra veeresh_infra 2782158 Sep 20 09:52 dump.log
veeresh_infra@cloudshell:~$

veeresh_infra@cloudshell:~$ kubectl cluster-info
Kubernetes master is running at https://35.226.14.115
GLBCDefaultBackend is running at https://35.226.14.115/api/v1/namespaces/kube-system/services/default-http-backend:http/proxy
Heapster is running at https://35.226.14.115/api/v1/namespaces/kube-system/services/heapster/proxy
KubeDNS is running at https://35.226.14.115/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
Metrics-server is running at https://35.226.14.115/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
veeresh_infra@cloudshell:~$

more info on this  https://www.mankier.com/1/kubectl-cluster-info-dump

Dumps cluster info out suitable for debugging and diagnosing cluster problems.  By default, dumps everything to stdout. You can optionally specify a directory with --output-directory.  If you specify a directory, kubernetes will build a set of files in that directory.  By default only dumps things in the 'kube-system' namespace, but you can switch to a different namespace with the --namespaces flag, or specify --all-namespaces to dump all namespaces.

The command also dumps the logs of all of the pods in the cluster, these logs are dumped into different directories based on namespace and pod name.

Options
-A, --all-namespaces=false
If true, dump all namespaces.  If true, --namespaces is ignored.

--allow-missing-template-keys=true
If true, ignore any errors in templates when a field or map key is missing in the template. Only applies to golang and jsonpath output formats.

--namespaces=[]
A comma separated list of namespaces to dump.

-o, --output="json"
Output format. One of: json|yaml|name|go-template|go-template-file|template|templatefile|jsonpath|jsonpath-file.

--output-directory=""
Where to output the files.  If empty or '-' uses stdout, otherwise creates a directory hierarchy in that directory

--pod-running-timeout=20s
The length of time (like 5s, 2m, or 3h, higher than zero) to wait until at least one pod is running

--template=""
Template string or path to template file to use when -o=go-template, -o=go-template-file. The template format is golang templates [ ?http://golang.org/pkg/text/template/#pkg-overview?].

Options Inherited from Parent Commands
========================